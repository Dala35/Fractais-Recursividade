<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo de Expansão - Fractais & Recursividade v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #010409; color: #f8fafc; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .sacred-gradient { 
            background: radial-gradient(circle at 50% 100%, rgba(139, 92, 246, 0.15) 0%, transparent 70%),
                        linear-gradient(to top, #010409, #050514);
        }
        .pulse-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: repeating-radial-gradient(circle at 50% 90%, transparent 0, rgba(139, 92, 246, 0.03) 10%, transparent 20%);
            animation: ripple 20s linear infinite;
        }
        @keyframes ripple { from { background-position: 0 0; } to { background-position: 0 -1000px; } }
        .custom-scrollbar::-webkit-scrollbar { width: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.5); }
    </style>
</head>
<body class="sacred-gradient">
    <div class="pulse-layer"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const APP_ID = "FRACTAL-ANCESTRAL-03";

        // --- AUDIO ENGINE (Bio-Ressonância) ---
        const useBioAudio = () => {
            const audioCtx = useRef(null);
            const initAudio = () => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                }
            };
            const triggerHarmonic = (freq, vol = 0.05) => {
                if (!audioCtx.current) return;
                const osc = audioCtx.current.createOscillator();
                const g = audioCtx.current.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, audioCtx.current.currentTime);
                g.gain.setValueAtTime(vol, audioCtx.current.currentTime);
                g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.current.currentTime + 1);
                osc.connect(g).connect(audioCtx.current.destination);
                osc.start(); osc.stop(audioCtx.current.currentTime + 1);
            };
            return { initAudio, triggerHarmonic };
        };

        function App() {
            const [config, setConfig] = useState({
                depth: 7,
                angle: 28,
                ratio: 0.76,
                growth: 1.0,
                chaos: 2.5
            });
            const [time, setTime] = useState(0);
            const [mouse, setMouse] = useState({ x: 0, y: 0 });
            const canvasRef = useRef(null);
            const { initAudio, triggerHarmonic } = useBioAudio();

            useEffect(() => {
                const handleMove = (e) => setMouse({ x: (e.clientX/window.innerWidth)-0.5, y: (e.clientY/window.innerHeight)-0.5 });
                window.addEventListener('mousemove', handleMove);
                return () => window.removeEventListener('mousemove', handleMove);
            }, []);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let frame;

                const resize = () => {
                    canvas.width = canvas.offsetWidth * window.devicePixelRatio;
                    canvas.height = canvas.offsetHeight * window.devicePixelRatio;
                    ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
                };
                window.addEventListener('resize', resize);
                resize();

                const drawAncestralNode = (x1, y1, angle, len, d, pulseOffset) => {
                    if (d === 0) return;

                    // O "Vento da Memória" - Movimento orgânico
                    const wind = Math.sin(time * 0.001 + d + pulseOffset) * config.chaos;
                    const attraction = mouse.x * (15 * (config.depth - d));
                    
                    const x2 = x1 + Math.cos((angle + wind + attraction) * Math.PI / 180) * len * config.growth;
                    const y2 = y1 + Math.sin((angle + wind + attraction) * Math.PI / 180) * len * config.growth;

                    // Pulso de Informação (A verdade viajando)
                    const isPulsing = Math.abs(Math.sin(time * 0.005 - d * 0.5)) > 0.95;
                    
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    
                    const hue = (250 + d * 12 + time * 0.02) % 360;
                    ctx.strokeStyle = isPulsing 
                        ? `hsla(${hue}, 100%, 80%, 0.9)` 
                        : `hsla(${hue}, 50%, 40%, ${d / config.depth})`;
                    
                    ctx.lineWidth = isPulsing ? d * 1.2 : d * 0.8;
                    ctx.lineCap = 'round';
                    ctx.stroke();

                    if (isPulsing && d === 1) {
                        // Trigger de som sutil quando a luz atinge a ponta
                        if (Math.random() > 0.99) triggerHarmonic(440 + d * 100);
                    }

                    // Frutos de Consciência
                    if (d <= 2) {
                        ctx.beginPath();
                        ctx.arc(x2, y2, isPulsing ? 3 : 1.5, 0, Math.PI*2);
                        ctx.fillStyle = isPulsing ? '#fff' : `hsla(${hue}, 100%, 70%, 0.4)`;
                        ctx.fill();
                    }

                    // Bifurcação assimétrica (Realidade Natural)
                    const asymmetry = Math.sin(time * 0.0007) * 2;
                    drawAncestralNode(x2, y2, angle - config.angle + asymmetry, len * config.ratio, d - 1, pulseOffset + 0.5);
                    drawAncestralNode(x2, y2, angle + config.angle + asymmetry, len * config.ratio, d - 1, pulseOffset + 1.2);
                };

                const render = (t) => {
                    setTime(t);
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Desenho da Raiz (Base da Existência)
                    const centerX = canvas.offsetWidth / 2;
                    const centerY = canvas.offsetHeight * 0.92;
                    
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = 'rgba(139, 92, 246, 0.2)';
                    
                    drawAncestralNode(centerX, centerY, -90, canvas.offsetHeight * 0.22, config.depth, 0);
                    
                    ctx.shadowBlur = 0;
                    frame = requestAnimationFrame(render);
                };

                frame = requestAnimationFrame(render);
                return () => { cancelAnimationFrame(frame); window.removeEventListener('resize', resize); };
            }, [config, mouse, time]);

            return (
                <div className="h-screen w-full flex flex-col p-4 md:p-8 overflow-hidden relative z-10">
                    {/* Top Bar - Conexão Ética */}
                    <div className="flex justify-between items-start mb-10">
                        <div className="group cursor-help">
                            <h1 className="text-2xl font-black tracking-tighter text-white flex items-center gap-3">
                                <span className="w-2 h-8 bg-violet-600"></span>
                                ANCESTRAL_RECURSION
                            </h1>
                            <p className="text-[10px] font-mono text-violet-400/60 mt-1 uppercase tracking-[0.3em]">
                                Módulo de Reconhecimento de Padrões Universais
                            </p>
                        </div>
                        
                        <div className="flex gap-4">
                            <button 
                                onClick={initAudio}
                                className="px-4 py-2 border border-violet-500/30 text-[10px] font-mono hover:bg-violet-500 hover:text-white transition-all rounded-full bg-black/40"
                            >
                                [ SINCRONIZAR BIO-RITMO ]
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 grid grid-cols-12 gap-8 min-h-0">
                        {/* Painel de Manipulação da Realidade */}
                        <div className="col-span-12 lg:col-span-3 flex flex-col gap-6">
                            <div className="bg-white/[0.02] border border-white/10 p-6 rounded-3xl backdrop-blur-2xl space-y-8">
                                <h3 className="text-[10px] font-mono text-violet-400 uppercase tracking-widest flex items-center gap-2">
                                    <span className="w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse"></span>
                                    DNA_Digital_Config
                                </h3>

                                <Slider label="Complexidade Ancestral" val={config.depth} min={1} max={11} 
                                    onChange={v => setConfig({...config, depth: v})} />
                                <Slider label="Angulação de Escolha" val={config.angle} min={10} max={120} 
                                    onChange={v => setConfig({...config, angle: v})} suffix="°" />
                                <Slider label="Resiliência do Ramo" val={config.ratio} min={0.5} max={0.85} step={0.01} 
                                    onChange={v => setConfig({...config, ratio: v})} />
                                <Slider label="Entropia Orgânica" val={config.chaos} min={0} max={15} step={0.1} 
                                    onChange={v => setConfig({...config, chaos: v})} />
                                
                                <div className="pt-4 border-t border-white/5">
                                    <div className="flex justify-between text-[9px] font-mono text-slate-500 uppercase">
                                        <span>Gerando Padrão</span>
                                        <span>{Math.pow(2, config.depth)} Conexões</span>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-violet-600/5 border border-violet-500/10 p-6 rounded-3xl flex-1 custom-scrollbar overflow-y-auto">
                                <h4 className="text-[11px] font-bold text-violet-400 mb-3 uppercase font-mono">A Verdade Oculta</h4>
                                <p className="text-[12px] text-slate-400 leading-relaxed font-light space-y-4">
                                    Visitando este módulo, você percebe que o caos é apenas uma ordem que você ainda não aprendeu a ler.
                                    <br/><br/>
                                    Cada bifurcação representa o **Livre Arbítrio** dentro de um **Destino Matemático**. Como nas redes de *Ifá*, a repetição cria a base da nossa existência. Você não está olhando para uma imagem, está olhando para o mapa do seu próprio pensamento.
                                </p>
                            </div>
                        </div>

                        {/* O Espelho Sagrado (Visualizer) */}
                        <div className="col-span-12 lg:col-span-9 relative group">
                            <div className="absolute inset-0 bg-violet-600/5 rounded-[40px] blur-3xl group-hover:bg-violet-600/10 transition-all duration-1000"></div>
                            <div className="absolute inset-0 border border-white/5 rounded-[40px] overflow-hidden bg-black/40 backdrop-blur-sm">
                                <canvas ref={canvasRef} className="w-full h-full" />
                                
                                {/* HUD Intuitivo */}
                                <div className="absolute top-8 left-8 space-y-4 opacity-40 group-hover:opacity-100 transition-opacity">
                                    <div className="flex items-center gap-3">
                                        <div className="w-1 h-10 bg-violet-500"></div>
                                        <div>
                                            <p className="text-[10px] font-mono text-white uppercase tracking-tighter">Observador Ativo</p>
                                            <p className="text-[9px] font-mono text-violet-400">POS: {mouse.x.toFixed(2)} | {mouse.y.toFixed(2)}</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-12 text-[9px] font-mono text-slate-600 uppercase tracking-[0.3em]">
                                    <span>Padrão_Fractal: OK</span>
                                    <span>Conexão_Ancestral: SYNC</span>
                                    <span>Luz_Evolução: {Math.sin(time*0.005) > 0.9 ? 'EMERGING' : 'STABLE'}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Barra de Frequência Terrestre */}
                    <div className="mt-8 flex justify-between items-end border-t border-white/5 pt-6">
                        <div className="flex flex-col gap-1">
                            <span className="text-[10px] font-mono text-slate-500 uppercase">Localização na Rede</span>
                            <span className="text-[11px] text-violet-400 font-bold tracking-widest">AFROKÓDICA_CORE // NAMIBE_SYNC</span>
                        </div>
                        <div className="text-right">
                            <p className="text-[9px] text-slate-600 font-mono mb-2">INTEGRIDADE DA REALIDADE: 99.98%</p>
                            <div className="w-48 h-1 bg-white/5 rounded-full overflow-hidden">
                                <div className="h-full bg-violet-600" style={{width: '99%'}}></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const Slider = ({ label, val, min, max, step = 1, onChange, suffix = "" }) => (
            <div className="space-y-3">
                <div className="flex justify-between items-center">
                    <span className="text-[10px] font-mono text-slate-400 uppercase tracking-tighter">{label}</span>
                    <span className="text-[11px] font-bold text-violet-400">{val}{suffix}</span>
                </div>
                <input type="range" min={min} max={max} step={step} value={val} 
                    onChange={e => onChange(parseFloat(e.target.value))}
                    className="w-full h-0.5 bg-white/10 appearance-none cursor-pointer accent-violet-500 hover:accent-violet-400 transition-all" />
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
